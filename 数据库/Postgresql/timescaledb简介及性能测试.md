# timescaledbç®€ä»‹åŠæ€§èƒ½æµ‹è¯•
[![](https://cdn2.jianshu.io/assets/default_avatar/2-9636b13945b9ccf345bc98d0d81074eb.jpg)
](https://www.jianshu.com/u/136525c3d5b5)

2021.12.03 15:47:24 å­—æ•° 4,630 é˜…è¯» 66

## ä¸€ã€èƒŒæ™¯

éšç€ç‰©è”ç½‘çš„å‘å±•ï¼Œæ—¶åºæ•°æ®åº“çš„éœ€æ±‚è¶Šæ¥è¶Šå¤šï¼Œæ¯”å¦‚æ°´æ–‡ç›‘æ§ã€å·¥å‚çš„è®¾å¤‡ç›‘æ§ã€å›½å®¶å®‰å…¨ç›¸å…³çš„æ•°æ®ç›‘æ§ã€é€šè®¯ç›‘æ§ã€é‡‘èè¡Œä¸šæŒ‡æ ‡æ•°æ®ã€ä¼ æ„Ÿå™¨æ•°æ®ç­‰ã€‚  
åœ¨äº’è”ç½‘è¡Œä¸šä¸­ï¼Œä¹Ÿæœ‰ç€éå¸¸å¤šçš„æ—¶åºæ•°æ®ï¼Œä¾‹å¦‚ç”¨æˆ·è®¿é—®ç½‘ç«™çš„è¡Œä¸ºè½¨è¿¹ï¼Œåº”ç”¨ç¨‹åºäº§ç”Ÿçš„æ—¥å¿—æ•°æ®ç­‰ç­‰ã€‚

æ—¶åºæ•°æ®æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š

-   åŸºæœ¬ä¸Šéƒ½æ˜¯æ’å…¥ï¼Œæ²¡æœ‰æ›´æ–°çš„éœ€æ±‚ã€‚
-   æ•°æ®åŸºæœ¬ä¸Šéƒ½æœ‰æ—¶é—´å±æ€§ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ä¸æ–­äº§ç”Ÿæ–°çš„æ•°æ®ï¼Œæ—§çš„æ•°æ®ä¸éœ€è¦ä¿å­˜å¤ªä¹…ã€‚

ä¸šåŠ¡æ–¹å¯¹æ—¶åºæ•°æ®é€šå¸¸æœ‰å‡ ä¸ªæŸ¥è¯¢éœ€æ±‚ã€‚

-   è·å–æœ€æ–°çŠ¶æ€ï¼ŒæŸ¥è¯¢æœ€è¿‘çš„æ•°æ®ï¼ˆä¾‹å¦‚ä¼ æ„Ÿå™¨æœ€æ–°çš„çŠ¶æ€ï¼‰ã€‚
-   å±•ç¤ºåŒºé—´ç»Ÿè®¡ï¼ŒæŒ‡å®šæ—¶é—´èŒƒå›´ï¼ŒæŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚å¹³å‡å€¼ï¼Œæœ€å¤§å€¼ï¼Œæœ€å°å€¼ï¼Œè®¡æ•°ç­‰ã€‚
-   è·å–å¼‚å¸¸æ•°æ®ï¼Œæ ¹æ®æŒ‡å®šæ¡ä»¶ï¼Œç­›é€‰å¼‚å¸¸æ•°æ®ã€‚

## äºŒã€æ—¶åºæ•°æ®åº“åº”è¯¥å…·å¤‡çš„ç‰¹ç‚¹

-   å‹ç¼©èƒ½åŠ›  
    é€šå¸¸ç”¨å¾—ä¸Šæ—¶åºæ•°æ®åº“çš„ä¸šåŠ¡ï¼Œä¼ æ„Ÿå™¨äº§ç”Ÿçš„æ•°æ®é‡éƒ½æ˜¯éå¸¸åºå¤§çš„ï¼Œæ•°æ®å‹ç¼©å¯ä»¥é™ä½å­˜å‚¨æˆæœ¬ã€‚
-   è‡ªåŠ¨ rotate  
    æ—¶åºæ•°æ®é€šå¸¸å¯¹å†å²æ•°æ®çš„ä¿ç•™æ—¶é—´é—´éš”æ˜¯æœ‰è§„å®šçš„ï¼Œä¾‹å¦‚ä¸€ä¸ªçº¿ä¸Šæ—¶åºæ•°æ®ä¸šåŠ¡ï¼Œå¯èƒ½åªéœ€è¦ä¿ç•™æœ€è¿‘ 1 å‘¨çš„æ•°æ®ã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæ—¶åºæ•°æ®åº“å¿…é¡»æœ‰æ•°æ®è‡ªåŠ¨ rotate çš„èƒ½åŠ›ã€‚
-   æ”¯æŒåˆ†ç‰‡ï¼Œæ°´å¹³æ‰©å±•  
    å› ä¸ºæ¶‰åŠçš„ä¼ æ„Ÿå™¨å¯èƒ½å¾ˆå¤šï¼Œå•ä¸ªèŠ‚ç‚¹å¯èƒ½æ¯”è¾ƒå®¹æ˜“æˆä¸ºç“¶é¢ˆï¼Œæ‰€ä»¥æ—¶åºæ•°æ®åº“åº”è¯¥å…·å¤‡æ°´å¹³æ‰©å±•çš„èƒ½åŠ›ï¼Œä¾‹å¦‚åˆ†è¡¨åº”è¯¥æ”¯æŒæ°´å¹³åˆ†åŒºã€‚
-   è‡ªåŠ¨æ‰©å±•åˆ†åŒºï¼Œ  
    ä¸šåŠ¡å¯¹æ—¶åºæ•°æ®çš„æŸ¥è¯¢ï¼Œå¾€å¾€éƒ½ä¼šå¸¦ä¸Šå¯¹æ—¶é—´åŒºé—´è¿›è¡Œè¿‡æ»¤ï¼Œå› æ­¤æ—¶åºæ•°æ®é€šå¸¸åœ¨åˆ†åŒºæ—¶ï¼Œä¸€å®šä¼šæœ‰ä¸€ä¸ªæ—¶é—´åˆ†åŒºçš„æ¦‚å¿µã€‚æ—¶åºæ•°æ®åº“åŠ¡å¿…èƒ½å¤Ÿæ”¯æŒè‡ªåŠ¨æ‰©å±•åˆ†åŒºï¼Œå‡å°‘ç”¨æˆ·çš„ç®¡ç†é‡ï¼Œä¸éœ€è¦äººä¸ºçš„å¹²é¢„è‡ªåŠ¨æ‰©å±•åˆ†åŒºã€‚ä¾‹å¦‚ 1 æœˆä»½æœˆæœ«ï¼Œè‡ªåŠ¨åˆ›å»º 2 æœˆä»½çš„åˆ†åŒºã€‚
-   æ’å…¥æ€§èƒ½  
    æ—¶åºæ•°æ®ï¼Œæ’å…¥æ˜¯ä¸€ä¸ªå¼ºéœ€æ±‚ã€‚å¯¹äºæ’å…¥æ€§èƒ½è¦æ±‚è¾ƒé«˜ã€‚
-   åˆ†åŒºå¯åˆ é™¤  
    åˆ†åŒºå¯ä»¥è¢«åˆ é™¤ï¼Œä¾‹å¦‚ä¿ç•™ 1 ä¸ªæœˆçš„æ•°æ®ï¼Œ1 ä¸ªæœˆä»¥å‰çš„åˆ†åŒºéƒ½å¯ä»¥åˆ é™¤æ‰ã€‚
-   æ˜“ç”¨æ€§ (SQL æ¥å£)  
    SQL æ˜¯ç›®å‰æœ€é€šç”¨çš„æ•°æ®åº“è®¿é—®è¯­è¨€ï¼Œå¦‚æœæ—¶åºæ•°æ®åº“èƒ½æ”¯æŒ SQL æ˜¯æœ€å¥½çš„ã€‚
-   ç±»å‹ä¸°å¯Œ  
    ç‰©è”ç½‘çš„ç»ˆç«¯å„å¼‚ï¼Œä¼šæœ‰è¶Šæ¥è¶Šå¤šçš„éæ ‡å‡†ç±»å‹çš„æ”¯æŒéœ€æ±‚ã€‚ä¾‹å¦‚é‡‡é›†å›¾åƒçš„ä¼ æ„Ÿå™¨ï¼Œæ•°æ®åº“ä¸­è‡³å°‘è¦èƒ½å¤Ÿå­˜å–å›¾åƒçš„ç‰¹å¾å€¼ã€‚è€Œå¯¹äºå…¶ä»–å‚ç›´è¡Œä¸šä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸ºäº†æœ€å¤§ç¨‹åº¦çš„è¯ é‡Šä¸šåŠ¡ï¼Œå¿…é¡»è¦æœ‰ç²¾å‡†çš„æ•°æ®ç±»å‹æ¥æ”¯æ’‘ã€‚
-   ç´¢å¼•æ¥å£  
    æ”¯æŒç´¢å¼•ï¼Œæ¯«æ— ç–‘é—®æ˜¯ä¸ºäº†åŠ é€ŸæŸ¥è¯¢è€Œå¼•å…¥çš„ã€‚
-   é«˜æ•ˆåˆ†æèƒ½åŠ›  
    æ—¶åºæ•°æ®ï¼Œé™¤äº†å•æ¡çš„æŸ¥è¯¢ï¼Œæ›´å¤šçš„æ˜¯æŠ¥è¡¨åˆ†ææˆ–è€…å…¶ä»–çš„åˆ†æç±»éœ€æ±‚ã€‚è¿™å¯¹æ—¶åºæ•°æ®åº“çš„ç»Ÿè®¡èƒ½åŠ›ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚
-   å…¶ä»–ç‰¹è‰²  
    ï¼ˆ1ï¼‰æ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œæ•°ç»„ã€èŒƒå›´ç±»å‹ã€JSON ç±»å‹ã€K-V ç±»å‹ã€GIS ç±»å‹ã€å›¾ç±»å‹ç­‰ã€‚æ»¡è¶³æ›´å¤šçš„å·¥ä¸šåŒ–éœ€æ±‚ï¼Œä¾‹å¦‚ä¼ æ„Ÿå™¨çš„ä½ç½®ä¿¡æ¯ã€ä¼ æ„Ÿå™¨ä¸Šä¼ çš„æ•°æ®å€¼çš„èŒƒå›´ï¼Œæ‰¹é‡ä»¥æ•°ç»„æˆ– JSON çš„å½¢å¼ä¸Šä¼ ï¼Œä¼ æ„Ÿå™¨ç”šè‡³å¯èƒ½ä¸Šä¼ å›¾ç‰‡ç‰¹å¾å€¼ï¼Œä¾¿äºå›¾ç‰‡çš„åˆ†æã€‚ï¼ˆä¾‹å¦‚å›½å®¶å®‰å…¨ç›¸å…³ï¼‰ï¼Œè½¨è¿¹æ•°æ®çš„ä¸Šå±‚åˆ™å¸¦æœ‰ GIS å±æ€§ã€‚  
    è¿™ä¸ªä¸–ç•Œéœ€è¦çš„æ˜¯æ”¯æŒç±»å‹ä¸°å¯Œçš„æ—¶åºæ•°æ®åº“ï¼Œè€Œä¸æ˜¯ä»…ä»…æ”¯æŒç®€å•ç±»å‹çš„æ—¶åºæ•°æ®åº“ã€‚  
    ï¼ˆ2ï¼‰æ”¯æŒä¸°å¯Œçš„ç´¢å¼•æ¥å£ï¼Œå› ä¸ºç±»å‹ä¸°å¯Œäº†ï¼Œæ™®é€šçš„ B-TREE ç´¢å¼•å¯èƒ½æ— æ³•æ»¡è¶³å¿«é€Ÿçš„æ£€ç´¢éœ€æ±‚ï¼Œéœ€è¦æ›´å¤šçš„ç´¢å¼•æ¥æ”¯æŒ æ•°ç»„ã€JSONã€GISã€å›¾ç‰¹å¾å€¼ã€K-Vã€èŒƒå›´ç±»å‹ç­‰ã€‚ (ä¾‹å¦‚ PostgreSQL çš„ gin, gist, sp-gist, brin, rum, bloom, hash ç´¢å¼•æ¥å£)ã€‚  
    è¿™ä¸¤ç‚¹å¯ä»¥ç»§æ‰¿ PostgreSQL æ•°æ®åº“çš„å·²æœ‰åŠŸèƒ½ï¼Œå·²å®Œå…¨æ»¡è¶³ã€‚

## ä¸‰ã€TimescaleDB ä»‹ç»

TimescaleDB æ˜¯åŸºäº PostgreSQL æ•°æ®åº“æ‰“é€ çš„ä¸€æ¬¾æ—¶åºæ•°æ®åº“ï¼Œæ’ä»¶åŒ–çš„å½¢å¼ï¼Œéšç€ PostgreSQL çš„ç‰ˆæœ¬å‡çº§è€Œå‡çº§ï¼Œä¸ä¼šå› ä¸ºå¦ç«‹åˆ†æ”¯å¸¦æ¥éº»çƒ¦ã€‚

![](https://upload-images.jianshu.io/upload_images/20224274-89e371d157166555.png)

å›¾ 1 timescaleDB ç»“æ„

æ•°æ®è‡ªåŠ¨æŒ‰æ—¶é—´å’Œç©ºé—´åˆ†ç‰‡ï¼ˆchunkï¼‰

-   partition keyï¼ˆåˆ†åŒºé”®ï¼‰  
    æ˜¯ç”±ä¸€ä¸ªè¡¨ä¸Šçš„ä¸€ä¸ªåˆ—æˆ–è€…å¤šä¸ªåˆ—ç»„æˆï¼Œç”¨äºç¡®å®šæŸä¸€è¡Œç‰¹å®šæ•°æ®åˆ†å¸ƒåœ¨å“ªä¸ªåˆ†åŒºä¸Šï¼Œç”¨ create table è¯­å¥æ¥å®šä¹‰ã€‚
-   chunks  
    åˆ†åŒºåœ¨ TimescaleDB ä¸­è¢«ç§°ä¸º chunkã€‚
-   query across time  
    è·¨æ—¶é—´æŸ¥è¯¢
-   query across space  
    è·¨ç©ºé—´æŸ¥è¯¢

**é€æ˜è‡ªåŠ¨åˆ†åŒºç‰¹æ€§**  
åœ¨æ—¶åºæ•°æ®çš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œå…¶è®°å½•æ•°å¾€å¾€æ˜¯éå¸¸åºå¤§çš„ï¼Œå¾ˆå®¹æ˜“å°±è¾¾åˆ° æ•°ä»¥äº¿è®¡ ã€‚è€Œå¯¹äº PG æ¥è¯´ï¼Œç”±äºå¤§é‡çš„è¿˜æ˜¯ä½¿ç”¨ B+tree ç´¢å¼•ï¼Œæ‰€ä»¥å½“æ•°æ®é‡åˆ°è¾¾ä¸€å®šé‡çº§åå…¶å†™å…¥æ€§èƒ½å°±ä¼šå‡ºç°æ˜æ˜¾çš„ä¸‹é™ï¼ˆè¿™é€šå¸¸æ˜¯ç”±äºç´¢å¼•æœ¬èº«å˜å¾—éå¸¸åºå¤§ä¸”å¤æ‚ï¼‰ã€‚è¿™æ ·çš„æ€§èƒ½ä¸‹é™å¯¹äºæ—¶åºæ•°æ®çš„åº”ç”¨åœºæ™¯è€Œè¨€æ˜¯ä¸èƒ½å¿å—çš„ï¼Œè€Œ TimescaleDB æœ€æ ¸å¿ƒçš„è‡ªåŠ¨åˆ†åŒºç‰¹æ€§è§£å†³çš„å°±æ˜¯è¿™ä¸ªé—®é¢˜ã€‚è¿™ä¸ªç‰¹æ€§å¸Œæœ›è¾¾åˆ°çš„ç›®æ ‡å¦‚ä¸‹ï¼š

-   éšç€æ•°æ®å†™å…¥çš„ä¸æ–­å¢åŠ ï¼Œå°†æ—¶åºæ•°æ®è¡¨çš„æ•°æ®åˆ†åŒºå­˜æ”¾ï¼Œä¿è¯æ¯ä¸€ä¸ªåˆ†åŒºçš„ç´¢å¼•ç»´æŒåœ¨ä¸€ä¸ªè¾ƒå°è§„æ¨¡ï¼Œä»è€Œç»´æŒä½å†™å…¥æ€§èƒ½ã€‚
-   åŸºäºæ—¶åºæ•°æ®çš„æŸ¥è¯¢åœºæ™¯ï¼Œè‡ªåŠ¨åˆ†åŒºæ—¶ä»¥æ—¶åºæ•°æ®çš„æ—¶é—´æˆ³ä¸ºåˆ†åŒºé”®ï¼Œä»è€Œç¡®ä¿æŸ¥è¯¢æ—¶å¯ä»¥å¿«é€Ÿå®šä½åˆ°æ‰€éœ€çš„æ•°æ®åˆ†åŒºï¼Œä¿è¯æŸ¥è¯¢æ€§èƒ½ã€‚
-   åˆ†åŒºè¿‡ç¨‹å¯¹ç”¨æˆ·é€æ˜ï¼Œä»è€Œè¾¾åˆ°è‡ªåŠ¨æ‰©å±•çš„æ•ˆæœã€‚

![](https://upload-images.jianshu.io/upload_images/20224274-2e716e6de7fc49c4.png)

å›¾ 2 PG åº“åˆ†åŒº

ä¸Šå›¾æ˜¯ PG10 å£°æ˜å¼åˆ†åŒºç¤ºä¾‹ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè¡¨æ ‘ï¼Œä»¥ä¸»è¡¨ä¸ºæ ¹ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸‹ä¸€ä¸ªå­çº§åˆ«çš„å››ä¸ªè®¾å¤‡è¡¨ï¼Œç„¶åæ˜¯ä»»æ„æ•°é‡çš„æ—¶é—´è¡¨ç¬¬ä¸‰ä¸ªå­å±‚æ¬¡ã€‚ä¸Šå›¾æ˜¾ç¤ºäº† PG åº“å¤šç»´è¡¨åˆ†åŒºçš„æ¦‚å¿µè§†å›¾ã€‚

PostgresSQL åˆ†åŒºçš„æ„æ€æ˜¯æŠŠé€»è¾‘ä¸Šçš„ä¸€ä¸ªå¤§è¡¨åˆ†å‰²æˆç‰©ç†ä¸Šçš„å‡ å—å„¿ã€‚åœ¨ PG é‡Œè¡¨åˆ†åŒºæ˜¯é€šè¿‡è¡¨ç»§æ‰¿æ¥å®ç°çš„ï¼Œä¸€èˆ¬éƒ½æ˜¯å»ºç«‹ä¸€ä¸ªä¸»è¡¨ï¼Œé‡Œé¢æ˜¯ç©ºï¼Œç„¶åæ¯ä¸ªåˆ†åŒºéƒ½å»ç»§æ‰¿å®ƒã€‚æ— è®ºä½•æ—¶ï¼Œéƒ½åº”ä¿è¯ä¸»è¡¨é‡Œé¢æ˜¯ç©ºçš„ã€‚

PostgreSQL 10.x ä¹‹å‰çš„ç‰ˆæœ¬æä¾›äº†ä¸€ç§ â€œæ‰‹åŠ¨â€ æ–¹å¼ä½¿ç”¨åˆ†åŒºè¡¨çš„æ–¹å¼ï¼Œéœ€è¦ä½¿ç”¨ç»§æ‰¿ + è§¦å‘å™¨çš„æ¥å®ç°åˆ†åŒºè¡¨ï¼Œæ­¥éª¤è¾ƒä¸ºç¹çï¼Œéœ€è¦å®šä¹‰é™„è¡¨ã€å­è¡¨ã€å­è¡¨çš„çº¦æŸã€åˆ›å»ºå­è¡¨ç´¢å¼•ï¼Œåˆ›å»ºåˆ†åŒºåˆ é™¤ã€ä¿®æ”¹ï¼Œè§¦å‘å™¨ç­‰ã€‚[PostgreSQL åˆ†åŒºè¡¨ï¼ˆTable Partitioningï¼‰åº”ç”¨](https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fmchina%2Farchive%2F2013%2F04%2F09%2F2973427.html)

PostgreSQL 10.x å¼€å§‹æä¾›äº†å†…ç½®åˆ†åŒºè¡¨ï¼ˆå†…ç½®æ˜¯ç›¸å¯¹äº 10.x ä¹‹å‰çš„æ‰‹åŠ¨æ–¹å¼ï¼‰ã€‚å†…ç½®åˆ†åŒºç®€åŒ–äº†æ“ä½œï¼Œå°†éƒ¨åˆ†æ“ä½œå†…ç½®ï¼Œæœ€ç»ˆç®€å•ä¸‰æ­¥å°±èƒ½å¤Ÿåˆ›å»ºåˆ†åŒºè¡¨ã€‚ä½†æ˜¯åªæ”¯æŒèŒƒå›´åˆ†åŒºï¼ˆRANGEï¼‰å’Œåˆ—è¡¨åˆ†åŒºï¼ˆLISTï¼‰ï¼Œ11.x ç‰ˆæœ¬æ·»åŠ äº†å¯¹ HASH åˆ†åŒºã€‚[PostgreSQL 10 åˆ†åŒºè¡¨æ€§èƒ½æµ‹è¯•](https://www.jianshu.com/p/c646f26feb04)

ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œéœ€è¦æ¯ä¸ªæ—¶é—´é—´éš”åˆ›å»ºå››ä¸ªæ–°è¡¨ï¼Œæ¯ä¸ªè®¾å¤‡ä¸€ä¸ªã€‚é¢å¤–çš„è®¾å¤‡å°†ä½¿åˆ†åŒºç­–ç•¥è¿›ä¸€æ­¥å¤æ‚åŒ–ï¼Œæ‰€æœ‰è¿™äº›é¢å¤–çš„è¡¨éƒ½å¯èƒ½å¯¹æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§äº§ç”Ÿè´Ÿé¢å½±å“ï¼Œå› ä¸ºéœ€è¦ä¸ºæ’å…¥å’ŒæŸ¥è¯¢å¤„ç†æ›´å¤šçš„è¡¨ã€‚

TimescaleDB ä¹Ÿä¾èµ–äºè¡¨ç»§æ‰¿ï¼Œä½†é¿å…äº†æ·±åº¦åµŒå¥—çš„å¤šçº§ç»§æ‰¿æ ‘ã€‚ç›¸åï¼Œå®ƒç›´æ¥åœ¨æ ¹åˆ›å»ºä¸€ä¸ªæµ…å±‚å¶å—æ ‘ï¼Œè€Œä¸ç®¡åˆ†åŒºç»´åº¦çš„æ•°é‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

![](https://upload-images.jianshu.io/upload_images/20224274-17719fd143925fda.png)

å›¾ 3 TimescaleDB åˆ†åŒº

å½©è‰²æ¡†ä»£è¡¨ä¸åŒçš„â€ ç©ºé—´â€ é”®ï¼ˆä¾‹å¦‚ï¼Œæˆ‘ä»¬ç¤ºä¾‹ä¸­çš„è®¾å¤‡ï¼‰ã€‚è¿™æ ·å­çš„è®¾è®¡å‡å°‘äº†æ ‘ä¸­è¡¨çš„æ•°é‡å¹¶é¿å…äº†åµŒå¥—ã€‚é€šè¿‡è¿™æ ·åšï¼ŒTimescaleDB æé«˜äº†æ’å…¥å’ŒæŸ¥è¯¢æ€§èƒ½ï¼Œç®€åŒ–äº†é‡æ–°åˆ†åŒºï¼Œå¹¶ä½¿è¡¨ç®¡ç†ï¼ˆå’Œä¿ç•™ï¼‰æ›´å®¹æ˜“ã€‚

### å››ã€æ€§èƒ½æµ‹è¯•

ç¯å¢ƒï¼š

-   æ“ä½œç³»ç»Ÿï¼šCentOS 7.8ï¼ˆè™šæ‹Ÿæœºï¼‰
-   Postgresql ç‰ˆæœ¬ï¼š12.1
-   TimescaleDB ç‰ˆæœ¬ï¼š2.2.0
-   CPUï¼šIntel Core i7 9xx 1 æ ¸å¿ƒ 4 çº¿ç¨‹
-   å†…å­˜ï¼š4G
-   ç¡¬ç›˜ï¼š100G
-   æ—¶åºåº“å®‰è£…å‚è€ƒ [ç¦»çº¿å®‰è£… Postgresã€æ—¶åºåº“ (timescaledb)](https://www.jianshu.com/p/f6061ac99ef4)

**å®‰è£…å·¥å…·**

1ã€golang ç¯å¢ƒå®‰è£…è¯¦è§[centos 7 å®‰è£… golang](https://www.jianshu.com/p/35a161738d83)  
2ã€TSBS å®‰è£…  
TSBS ç”¨äºå¯¹æ‰¹é‡åŠ è½½æ€§èƒ½å’ŒæŸ¥è¯¢æ‰§è¡Œæ€§èƒ½è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚ï¼ˆç›®å‰ä¸æµ‹é‡å¹¶å‘æ’å…¥å’ŒæŸ¥è¯¢æ€§èƒ½ï¼‰[github ä¸Šçš„ tsbs](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Ftimescale%2Ftsbs)

    cd $GOPATH
    yum install git
    git clone https://gitee.com/mirrors_toddlipcon/tsbs.git
    cd tsbs/cmd
    go get ./... 

3ã€å®‰è£… postgres ç¼“å­˜æ¸…ç†æ‰©å±• pg_dropcache,![](https://math.jianshu.com/math?formula=%5Ccolor%7Bred%7D%7B%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%85%8E%E7%94%A8%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%7D)

    #è¿›å…¥contribç›®å½•ä¸‹,ä¸‹è½½pg_dropcache
    git clone git://github.com/zilder/pg_dropcache
    cd pg_dropcache
    make 
    make install USE_PGXS=1 

**ç”Ÿæˆæµ‹è¯•æ•°æ®**

    tsbs_generate_data --use-case="cpu-only" --seed=123 --scale=4000 --timestamp-start="2021-01-01T00:00:00Z" --timestamp-end="2021-01-04T00:00:00Z" --log-interval="10s" --format="timescaledb" | gzip > /tmp/timescaledb-data.gz 

> éœ€è¦çš„å˜é‡ï¼š  
> 1.--use-caseï¼šåˆ†ä¸º iotã€cpu-only å’Œ devopsï¼Œä¾‹å¦‚ cpu-only  
> 2.--seedï¼šä¸€ç§ç”¨äºç¡®å®šæ€§ç”Ÿæˆçš„ PRNG ç§å­ï¼Œä¾‹å¦‚ 123  
> 3.--scaleï¼šéœ€è¦ç”Ÿæˆçš„è®¾å¤‡æ•°é‡ï¼Œä¾‹å¦‚ 4000  
> 4.--timestamp-startï¼šæ•°æ®ç”Ÿæˆçš„å¼€å§‹æ—¶é—´ï¼Œä¾‹å¦‚ 2016-01-01T00:00:00Z  
> 5.--timestamp-endï¼šæ•°æ®ç”Ÿæˆçš„ç»“æŸæ—¶é—´ï¼Œä¾‹å¦‚ 2016-01-04T00:00:00Z  
> 6.--log-intervalï¼šä»¥ç§’ä¸ºå•ä½è¯»å–æ¯ä¸ªè®¾å¤‡ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œä¾‹å¦‚ 10  
> 7.--formatï¼šéœ€è¦ç”Ÿæˆçš„æ•°æ®åº“ï¼Œ ä¾‹å¦‚ timescaledb (cassandraã€clickhouseã€cratedbã€influxã€mongoã€siridbã€timescaledb)

ä¸Šé¢çš„ç¤ºä¾‹å°†ç”Ÿæˆä¸€ä¸ªä¼ª CSV æ–‡ä»¶ï¼Œå¯ç”¨äºå°†æ•°æ®æ‰¹é‡åŠ è½½åˆ° TimescaleDB ä¸­ã€‚ä¸Šé¢çš„é…ç½®å°†ç”Ÿæˆè¶…è¿‡ 1 äº¿è¡Œã€‚æ—¶é—´æ®µæ¯å¢åŠ ä¸€å¤©å°†å¢åŠ å¤§çº¦ 3300 ä¸‡è¡Œï¼Œ30 å¤©å°†äº§ç”Ÿ 10 äº¿è¡Œã€‚

**ç”ŸæˆæŸ¥è¯¢è„šæœ¬**  
æœ¬æµ‹è¯•æ²¡æœ‰ä½¿ç”¨è¿™äº›æµ‹è¯•è„šæœ¬ï¼Œå› ä¸ºç”Ÿæˆçš„è„šæœ¬ä½¿ç”¨çš„ time_bucket() æ˜¯ timescaledb ä¸“å±æ–¹æ³•ã€‚ä¸è¿‡å€Ÿé‰´äº†ç›¸å…³çš„æŸ¥è¯¢æ–¹æ³•ã€‚

    [root@panghu tsbs]# FORMATS="timescaledb" SCALE=4000 SEED=123 TS_START="2021-01-01T00:00:00Z" TS_END="2021-01-04T00:00:01Z" QUERIES=1000 QUERY_TYPES="single-groupby-1-1-1 single-groupby-1-1-12 single-groupby-1-8-1 single-groupby-5-1-1 single-groupby-5-1-12 single-groupby-5-8-1 cpu-max-all-1 cpu-max-all-8 double-groupby-1 double-groupby-5 double-groupby-all high-cpu-all high-cpu-1 lastpoint groupby-orderby-limit" BULK_DATA_DIR="/tmp/queries" scripts/generate_queries.sh 

**å†™å…¥æ•°æ®**  
-- æ™®é€šè¡¨  
åœ¨ tsbs ç›®å½•ä¸‹æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œå…¶å‚æ•°è¡¨ç¤ºæ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œåˆ›å»ºæ™®é€šè¡¨ï¼Œæ¯ 30s è¾“å‡ºä¸€æ¬¡æŠ¥å‘Šï¼Œå¹¶å°†æŠ¥å‘Šè¾“å‡ºåˆ° normal.log

    NUM_WORKERS=1 USE_HYPERTABLE=false REPORTING_PERIOD=30s BULK_DATA_DIR=/tmp \ 
    DATABASE_NAME=normal scripts/load_timescaledb.sh > normal.log 

\-- è¶…è¡¨  
å…¶åˆ›å»ºçš„æ˜¯ä»¥ 12 å°æ—¶åˆ†å—çš„è¶…è¡¨

    NUM_WORKERS=1 CHUNK_TIME=12h USE_HYPERTABLE=true REPORTING_PERIOD=30s \
    DATABASE_NAME=hyper BULK_DATA_DIR=/tmp scripts/load_timescaledb.sh > hypertable.log 

ç»è¿‡ 1 äº¿æ•°æ®é‡çš„æµ‹è¯•ï¼Œå¹¶æ²¡æœ‰å‘ç° timescaledb åœ¨ insert æ–¹é¢çš„ä¼˜åŠ¿ã€‚å¯èƒ½æ˜¯æœºå™¨é…ç½®æˆ–æ•°æ®åº“é…ç½®é—®é¢˜ï¼Œä¹Ÿå¯èƒ½æ˜¯æµ‹è¯•æ•°æ®ä¸å¤Ÿå¤§ã€‚ç›¸æ¯”æ¥è¯´ pg é€Ÿåº¦æ¯” timescaledb å¿«ï¼Œä½† timescaledb çš„æ’å…¥é€Ÿåº¦ä¸€ç›´éƒ½æ¯”è¾ƒç¨³å®šã€‚timescaledb å®˜ç½‘ä¸Šä¹Ÿåªæœ‰ä¸€å¼ å›¾ï¼Œå¹¶æ²¡æœ‰è¯¦ç»†çš„æµ‹è¯•åœºæ™¯ä»‹ç»ã€‚

![](https://upload-images.jianshu.io/upload_images/20224274-447ec9ccdc5a0a2b.png)

å›¾ 4 å®˜ç½‘æµ‹è¯•

æŒ‰ç…§å®˜ç½‘çš„è§£é‡Šï¼Œå½“å‘ PostgreSQL ä¸­æ’å…¥æ–°çš„æ•°æ®è¡Œæ—¶ï¼Œæ•°æ®åº“éœ€è¦æ›´æ–°è¡¨çš„æ¯ä¸ªç´¢å¼•åˆ—çš„ç´¢å¼•ï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯ BTREEï¼‰ã€‚ä¸€æ—¦ç´¢å¼•å¤ªå¤§è€Œæ— æ³•æ”¾å…¥å†…å­˜â€”â€”æ ¹æ®åˆ†é…çš„å†…å­˜ï¼Œå½“è¡¨æ¯ 10s å†…æ’å…¥ä¸Šç™¾ä¸‡è¡Œæ•°æ®æ—¶ï¼Œé€šå¸¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µâ€”â€”è¿™éœ€è¦ä»ç£ç›˜äº¤æ¢ä¸€é¡µæˆ–å¤šé¡µã€‚æ­£æ˜¯è¿™ç§ç£ç›˜äº¤æ¢é€ æˆäº†æ’å…¥ç“¶é¢ˆã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸ŠæŠ•å…¥æ›´å¤šçš„å†…å­˜ä¸å¯é¿å…åœ°é€ æˆå»¶è¿Ÿã€‚

TimescaleDB é€šè¿‡å¤§é‡åˆ©ç”¨è‡ªåŠ¨æ—¶ç©ºåˆ†åŒºè§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œå³ä½¿æ˜¯è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œæ‰€æœ‰åœ¨æœ€è¿‘æ—¶é—´é—´éš”å†…çš„å†™å…¥éƒ½åªå¯¹ä¿ç•™åœ¨å†…å­˜ä¸­çš„è¡¨è¿›è¡Œã€‚è¿™ä½¿å¾—åœ¨å¤§è§„æ¨¡æ’å…¥æ•°æ®æ—¶ï¼Œæ’å…¥æ€§èƒ½æ¯” PostgreSQL æé«˜äº† 20 å€ã€‚

**æŸ¥è¯¢æ€§èƒ½æµ‹è¯•**  
é¦–å…ˆåœ¨ä¸¤ä¸ªåº“ä¸­å¼•å…¥ pg_dropcache

    [root@panghu pg_dropcache]# su - postgres -c psql
    postgres=# \c normal
    normal=# create extension pg_dropcache;
    normal=# \c hypertable 
    hypertable=# create extension pg_dropcache; 

æ¯æ¬¡æŸ¥è¯¢å‰éƒ½æ‰§è¡Œ

**ç®€å•æŸ¥è¯¢**  
1ã€1 å°è®¾å¤‡åœ¨ 1 å°æ—¶å†…æ¯ 1 åˆ†é’Ÿçš„ä¸€ä¸ªæŒ‡æ ‡ (ä¸€åˆ—) æœ€å¤§å€¼

    explain analyze select date_trunc('minute', time) as minute, max(usage_user) as max_usage_user from cpu where tags_id in (select id from tags where hostname in('host_249')) and time >='2021-01-02 00:00:00' and time < '2021-01-02 01:00:00' group by minute order by minute asc; 

\-- æ™®é€šè¡¨

     GroupAggregate  (cost=1529.58..1536.98 rows=370 width=16) (actual time=5.159..5.396 rows=60 loops=1)
       Group Key: (date_trunc('minute'::text, cpu."time"))
       ->  Sort  (cost=1529.58..1530.51 rows=370 width=16) (actual time=5.136..5.213 rows=360 loops=1)
             Sort Key: (date_trunc('minute'::text, cpu."time"))
             Sort Method: quicksort  Memory: 41kB
             ->  Nested Loop  (cost=0.85..1513.80 rows=370 width=16) (actual time=0.140..4.806 rows=360 loops=1)
                   ->  Index Scan using tags_hostname_idx on tags  (cost=0.28..8.30 rows=1 width=4) (actual time=0.060..0.062 rows=1 l
    oops=1)
                         Index Cond: (hostname = 'host_249'::text)
                   ->  Index Scan using cpu_tags_id_time_idx on cpu  (cost=0.57..1500.88 rows=370 width=20) (actual time=0.063..4.039 
    rows=360 loops=1)
                         Index Cond: ((tags_id = tags.id) AND ("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("tim
    e" < '2021-01-02 01:00:00+08'::timestamp with time zone))
     Planning Time: 1.079 ms
     Execution Time: 5.498 ms 

\-- è¶…è¡¨

     Sort  (cost=1477.89..1478.39 rows=200 width=16) (actual time=5.172..5.179 rows=60 loops=1)
       Sort Key: (date_trunc('minute'::text, _hyper_1_2_chunk."time"))
       Sort Method: quicksort  Memory: 27kB
       ->  HashAggregate  (cost=1467.74..1470.24 rows=200 width=16) (actual time=5.110..5.134 rows=60 loops=1)
             Group Key: date_trunc('minute'::text, _hyper_1_2_chunk."time")
             ->  Nested Loop  (cost=17.52..1465.91 rows=367 width=16) (actual time=0.416..4.783 rows=360 loops=1)
                   ->  Index Scan using tags_hostname_idx on tags  (cost=0.28..8.30 rows=1 width=4) (actual time=0.193..0.199 rows=1 l
    oops=1)
                         Index Cond: (hostname = 'host_249'::text)
                   ->  Bitmap Heap Scan on _hyper_1_2_chunk  (cost=17.24..1453.02 rows=367 width=20) (actual time=0.209..4.104 rows=36
    0 loops=1)
                         Recheck Cond: ((tags_id = tags.id) AND ("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("t
    ime" < '2021-01-02 01:00:00+08'::timestamp with time zone))
                         Heap Blocks: exact=360
                         ->  Bitmap Index Scan on _hyper_1_2_chunk_cpu_tags_id_time_idx  (cost=0.00..17.15 rows=367 width=0) (actual t
    ime=0.149..0.149 rows=360 loops=1)
                               Index Cond: ((tags_id = tags.id) AND ("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND
     ("time" < '2021-01-02 01:00:00+08'::timestamp with time zone))
     Planning Time: 1.235 ms
     Execution Time: 5.264 ms 

2ã€æ‰©å¤§æŸ¥è¯¢æ—¶é—´ï¼Œ12 å°æ—¶å†…ï¼Œæ¯åˆ†é’Ÿçš„æ•°æ®æœ€å¤§å€¼

    explain analyze select date_trunc('minute', time) as minute, max(usage_user) as max_usage_user from cpu where tags_id in (select id from tags where hostname in('host_555')) and time >='2021-01-02 00:00:00' and time < '2021-01-02 12:00:00' group by minute order by minute asc; 

\-- æ™®é€šè¡¨

     GroupAggregate  (cost=18034.27..18124.93 rows=4533 width=16) (actual time=54.607..57.942 rows=720 loops=1)
       Group Key: (date_trunc('minute'::text, cpu."time"))
       ->  Sort  (cost=18034.27..18045.61 rows=4533 width=16) (actual time=54.586..55.601 rows=4320 loops=1)
             Sort Key: (date_trunc('minute'::text, cpu."time"))
             Sort Method: quicksort  Memory: 395kB
             ->  Nested Loop  (cost=186.64..17758.98 rows=4533 width=16) (actual time=3.339..51.775 rows=4320 loops=1)
                   ->  Index Scan using tags_hostname_idx on tags  (cost=0.28..8.30 rows=1 width=4) (actual time=0.059..0.066 rows=1 loops=1)
                         Index Cond: (hostname = 'host_555'::text)
                   ->  Bitmap Heap Scan on cpu  (cost=186.36..17694.02 rows=4533 width=20) (actual time=3.260..45.543 rows=4320 loops=1)
                         Recheck Cond: ((tags_id = tags.id) AND ("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 12:00:00+08'::timestamp with time zone))
                         Heap Blocks: exact=4320
                         ->  Bitmap Index Scan on cpu_tags_id_time_idx  (cost=0.00..185.23 rows=4533 width=0) (actual time=2.229..2.229 rows=4320 loops=1)
                               Index Cond: ((tags_id = tags.id) AND ("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 12:00:00+08'::timestamp with time zone))
     Planning Time: 0.883 ms
     Execution Time: 58.365 ms 

\-- è¶…è¡¨

     Sort  (cost=17181.49..17181.99 rows=200 width=16) (actual time=55.692..55.797 rows=720 loops=1)
       Sort Key: (date_trunc('minute'::text, _hyper_1_2_chunk."time"))
       Sort Method: quicksort  Memory: 58kB
       ->  HashAggregate  (cost=17171.34..17173.84 rows=200 width=16) (actual time=55.070..55.374 rows=720 loops=1)
             Group Key: date_trunc('minute'::text, _hyper_1_2_chunk."time")
             ->  Nested Loop  (cost=116.85..17148.76 rows=4517 width=16) (actual time=2.083..51.022 rows=4320 loops=1)
                   ->  Index Scan using tags_hostname_idx on tags  (cost=0.28..8.30 rows=1 width=4) (actual time=0.081..0.087 rows=1 loops=1)
                         Index Cond: (hostname = 'host_555'::text)
                   ->  Append  (cost=116.57..17084.01 rows=4516 width=20) (actual time=1.989..45.468 rows=4320 loops=1)
                         ->  Bitmap Heap Scan on _hyper_1_2_chunk  (cost=116.57..10590.86 rows=2824 width=20) (actual time=1.983..30.447 rows=2880 loops=1)
                               Recheck Cond: ((tags_id = tags.id) AND ("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 12:00:00+08'::timestamp with time zone))
                               Heap Blocks: exact=2880
                               ->  Bitmap Index Scan on _hyper_1_2_chunk_cpu_tags_id_time_idx  (cost=0.00..115.86 rows=2824 width=0) (actual time=1.323..1.323 rows=2880 loops=1)
                                     Index Cond: ((tags_id = tags.id) AND ("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 12:00:00+08'::timestamp with time zone))
                         ->  Bitmap Heap Scan on _hyper_1_3_chunk  (cost=70.14..6470.57 rows=1692 width=20) (actual time=0.866..13.523 rows=1440 loops=1)
                               Recheck Cond: ((tags_id = tags.id) AND ("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 12:00:00+08'::timestamp with time zone))
                               Heap Blocks: exact=1440
                               ->  Bitmap Index Scan on _hyper_1_3_chunk_cpu_tags_id_time_idx  (cost=0.00..69.71 rows=1692 width=0) (actual time=0.588..0.589 rows=1440 loops=1)
                                     Index Cond: ((tags_id = tags.id) AND ("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 12:00:00+08'::timestamp with time zone))
     Planning Time: 1.978 ms
     Execution Time: 56.013 ms 

åœ¨å•ç£ç›˜æœºå™¨ä¸Šï¼Œè®¸å¤šåªæ‰§è¡Œç´¢å¼•æŸ¥æ‰¾æˆ–è¡¨æ‰«æçš„ç®€å•æŸ¥è¯¢åœ¨ TimescaleDB ä¸Šä¼šæ…¢ 1-3 æ¯«ç§’ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬å¸¦æœ‰ç´¢å¼•æ—¶é—´ã€ä¸»æœºåå’Œ cpu ä½¿ç”¨ä¿¡æ¯çš„ 1 äº¿ è¡Œè¡¨ä¸­ï¼Œæ¯ä¸ªæ•°æ®åº“å°†èŠ±è´¹ä¸åˆ° 3msï¼Œä½†åœ¨ TimescaleDB ä¸Šéœ€è¦é¢å¤– 1msã€‚ç”±äºè®¡åˆ’æ—¶é—´å¼€é”€ç¨å¤§ï¼Œå¤§å¤šæ•°é€šå¸¸éœ€è¦ &lt;20 æ¯«ç§’çš„ç®€å•æŸ¥è¯¢ï¼ˆä¾‹å¦‚ï¼Œç´¢å¼•æŸ¥æ‰¾ï¼‰åœ¨ TimescaleDB ä¸Šä¼šæ…¢å‡ æ¯«ç§’ã€‚

**åŸºäºæ—¶é—´çš„æŸ¥è¯¢**  
æŸ¥è¯¢åœ¨åŠå¤©é‡Œ CPU æŸä¸ªæŒ‡æ ‡è¶…è¿‡ 90 çš„æ•°æ®

    explain analyze select * from cpu where usage_user > 90.0 and  time >='2021-01-02 00:00:00' and time < '2021-01-02 12:00:00'; 

\-- æ™®é€šè¡¨

     Index Scan using cpu_time_idx on cpu  (cost=0.57..921587.58 rows=1661968 width=133) (actual time=93.180..157431.245 rows=1654719 loops=1)
       Index Cond: (("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 12:00:00+08'::timestamp with time zone))
       Filter: (usage_user > '90'::double precision)
       Rows Removed by Filter: 15625281
     Planning Time: 0.259 ms
     Execution Time: 157719.448 ms 

\-- è¶…è¡¨

     Gather  (cost=1000.00..902892.82 rows=1795682 width=133) (actual time=10107.044..111039.684 rows=1654719 loops=1)
       Workers Planned: 2
       Workers Launched: 2
       ->  Parallel Append  (cost=0.00..722324.62 rows=748201 width=133) (actual time=6100.415..106707.848 rows=551573 loops=3)
             ->  Parallel Index Scan using _hyper_1_3_chunk_cpu_time_idx on _hyper_1_3_chunk  (cost=0.44..294651.21 rows=275748 width=133) (actual time=55.335..81420.184 rows=180439 loops=3)
                   Index Cond: (("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 12:00:00+08'::timestamp with time zone))
                   Filter: (usage_user > '90'::double precision)
                   Rows Removed by Filter: 1739561
             ->  Parallel Seq Scan on _hyper_1_2_chunk  (cost=0.00..423932.41 rows=472453 width=133) (actual time=9092.177..37698.496 rows=556702 loops=2)
                   Filter: ((usage_user > '90'::double precision) AND ("time" >= '2021-01-02 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 12:00:00+08'::timestamp with time zone))
                   Rows Removed by Filter: 8083298
     Planning Time: 97.874 ms
     Execution Time: 111278.058 ms 

![](https://upload-images.jianshu.io/upload_images/20224274-1a7e25410cb614b4.png)

å›¾ 5 ä¸¤è€…æŸ¥è¯¢æ•°æ®é‡è¾ƒå¤§æ—¶æŸ¥è¯¢æ—¶é—´å¯¹æ¯”

åŸºäºæ—¶é—´çš„æŸ¥è¯¢ï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°æ®é‡è¾ƒå¤§æ—¶ï¼ŒtimescaleDB é€šå¸¸å¯ä»¥è¾¾åˆ° postgre å¤§çº¦ 1.2 åˆ° 5 å€çš„æ€§èƒ½ã€‚

**åŸºäºæ—¶é—´çš„èšåˆ**  
æŸ¥è¯¢ä¸€å¤©å†…æ¯ä¸ªè®¾å¤‡æ²¡å°æ—¶æŸä¸ªæµ‹å€¼å¹³å‡å€¼

    explain analyze select date_trunc('hour', time) as hour, hostname, avg(usage_user) as mean_usage_user from cpu where time >= '2021-01-01 00:00:00' and time < '2021-01-02 00:00:00' group by hour, hostname order by hour; 

\-- æ™®é€šè¡¨

     Finalize GroupAggregate  (cost=2805761.31..5565569.39 rows=9714638 width=25) (actual time=297183.377..302860.122 rows=64000 loops=1)
       Group Key: (date_trunc('hour'::text, "time")), hostname
       ->  Gather Merge  (cost=2805761.31..5274130.25 rows=19429276 width=49) (actual time=297183.100..303492.096 rows=192000 loops=1)
             Workers Planned: 2
             Workers Launched: 2
             ->  Partial GroupAggregate  (cost=2804761.28..3030509.69 rows=9714638 width=49) (actual time=296854.664..302114.907 rows=64000 loops=3)
                   Group Key: (date_trunc('hour'::text, "time")), hostname
                   ->  Sort  (cost=2804761.28..2830840.14 rows=10431543 width=25) (actual time=296854.443..299567.644 rows=7680000 loops=3)
                         Sort Key: (date_trunc('hour'::text, "time")), hostname
                         Sort Method: external merge  Disk: 310456kB
                         Worker 0:  Sort Method: external merge  Disk: 317048kB
                         Worker 1:  Sort Method: external merge  Disk: 315008kB
                         ->  Parallel Index Scan using cpu_time_idx on cpu  (cost=0.57..1089562.88 rows=10431543 width=25) (actual time=100.705..210288.786 rows=7680000 loops=3)
                               Index Cond: (("time" >= '2021-01-01 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 00:00:00+08'::timestamp with time zone))
     Planning Time: 2.233 ms
     Execution Time: 303763.514 ms 

\-- è¶…è¡¨

     Finalize GroupAggregate  (cost=2419133.87..2526990.01 rows=40000 width=25) (actual time=188301.739..196638.338 rows=64000 loops=1)
       Group Key: (date_trunc('hour'::text, _hyper_1_2_chunk."time")), _hyper_1_2_chunk.hostname
       ->  Gather Merge  (cost=2419133.87..2525790.01 rows=80000 width=49) (actual time=188301.571..196564.337 rows=136000 loops=1)
             Workers Planned: 2
             Workers Launched: 2
             ->  Partial GroupAggregate  (cost=2418133.85..2515556.00 rows=40000 width=49) (actual time=176953.907..181966.568 rows=45333 loops=3)
                   Group Key: (date_trunc('hour'::text, _hyper_1_2_chunk."time")), _hyper_1_2_chunk.hostname
                   ->  Sort  (cost=2418133.85..2442364.39 rows=9692215 width=25) (actual time=176919.752..179504.723 rows=7680000 loops=3)
                         Sort Key: (date_trunc('hour'::text, _hyper_1_2_chunk."time")), _hyper_1_2_chunk.hostname
                         Sort Method: external merge  Disk: 394720kB
                         Worker 0:  Sort Method: external merge  Disk: 150496kB
                         Worker 1:  Sort Method: external merge  Disk: 397320kB
                         ->  Result  (cost=0.00..829638.08 rows=9692215 width=25) (actual time=116.879..94302.311 rows=7680000 loops=3)
                               ->  Parallel Append  (cost=0.00..708485.39 rows=9692215 width=25) (actual time=116.857..88726.340 rows=7680000 loops=3)
                                     ->  Parallel Index Scan using _hyper_1_2_chunk_cpu_time_idx on _hyper_1_2_chunk  (cost=0.44..254091.97 rows=2492192 width=25) (actual time=208.773..59973.717 rows=1920000 loops=3)
                                           Index Cond: (("time" >= '2021-01-01 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 00:00:00+08'::timestamp with time zone))
                                     ->  Parallel Seq Scan on _hyper_1_1_chunk  (cost=0.00..405932.35 rows=7200023 width=25) (actual time=19.255..40519.150 rows=8640000 loops=2)
                                           Filter: (("time" >= '2021-01-01 00:00:00+08'::timestamp with time zone) AND ("time" < '2021-01-02 00:00:00+08'::timestamp with time zone))
     Planning Time: 276.695 ms
     Execution Time: 196843.845 ms 

![](https://upload-images.jianshu.io/upload_images/20224274-405b919333f84b3c.png)

å›¾ 6 åŸºäºæ—¶é—´èšåˆçš„å¯¹æ¯”

ç”±äº TimescaleDB çš„æ—¶ç©ºåˆ†åŒºï¼Œæˆ‘ä»¬çš„æ•°æ®é›†è‡ªç„¶åœ°è¢«åˆ’åˆ†æˆå—ï¼Œæ¯ä¸ªå—éƒ½æœ‰è‡ªå·±çš„ç´¢å¼•ã€‚è¿™åœ¨ä½¿ç”¨åŸºäºæ—¶é—´çš„èšåˆå¤„ç†æŸ¥è¯¢æ—¶æœ‰å‡ ä¸ªå¥½å¤„ã€‚åœ¨å„ç§å—ä¸Šä½¿ç”¨çº¦æŸæ’é™¤ï¼ŒTimescaleDB å¯ä»¥æ‰«ææ›´å°‘çš„æ•°æ®ï¼Œå…è®¸æ•°æ®åº“é€‰æ‹©æ›´åˆé€‚çš„è®¡åˆ’ï¼šä¾‹å¦‚ï¼Œå®Œå…¨åœ¨å†…å­˜ä¸­æ‰§è¡Œè®¡ç®—ä¸æº¢å‡ºåˆ°ç£ç›˜ï¼Œä½¿ç”¨æ›´å°çš„ç´¢å¼•ï¼ˆå› æ­¤å¯ä»¥éå†æ›´å°‘çš„ç´¢å¼•å€¼ï¼‰ï¼Œä½¿ç”¨æ›´å¥½çš„ç®—æ³•ï¼Œå¦‚ HashAggregates ä¸ GroupAggregates ç­‰ã€‚

**åŸºäºæ—¶é—´æ’åºçš„æŸ¥è¯¢**

1ã€åˆ†ç»„æŸ¥è¯¢å limit è·å–

    explain analyze select date_trunc('minute', time) as minute, max(usage_user) from cpu where time < '2021-01-01 19:00:00' group by minute order by minute desc limit 5; 

\-- æ™®é€šè¡¨

     Limit  (cost=743688.63..743689.91 rows=5 width=16) (actual time=160970.872..161024.248 rows=5 loops=1)
       ->  Finalize GroupAggregate  (cost=743688.63..747817.53 rows=16138 width=16) (actual time=160970.866..160970.876 rows=5 loops=1
    )
             Group Key: (date_trunc('minute'::text, "time"))
             ->  Gather Merge  (cost=743688.63..747454.42 rows=32276 width=16) (actual time=160970.840..161024.208 rows=16 loops=1)
                   Workers Planned: 2
                   Workers Launched: 2
                   ->  Sort  (cost=742688.60..742728.95 rows=16138 width=16) (actual time=160904.119..160904.186 rows=442 loops=3)
                         Sort Key: (date_trunc('minute'::text, "time")) DESC
                         Sort Method: quicksort  Memory: 55kB
                         Worker 0:  Sort Method: quicksort  Memory: 55kB
                         Worker 1:  Sort Method: quicksort  Memory: 55kB
                         ->  Partial HashAggregate  (cost=741358.98..741560.70 rows=16138 width=16) (actual time=160903.347..160903.77
    6 rows=660 loops=3)
                               Group Key: date_trunc('minute'::text, "time")
                               ->  Parallel Index Scan using cpu_time_idx on cpu  (cost=0.57..705526.81 rows=7166434 width=16) (actual
     time=43.759..158098.601 rows=5280000 loops=3)
                                     Index Cond: ("time" < '2021-01-01 19:00:00+08'::timestamp with time zone)
     Planning Time: 136.133 ms
     Execution Time: 161025.264 ms 

\-- è¶…è¡¨

     Limit  (cost=0.44..22819.45 rows=5 width=16) (actual time=296.532..1300.620 rows=5 loops=1)
       ->  GroupAggregate  (cost=0.44..912761.09 rows=200 width=16) (actual time=296.527..1300.604 rows=5 loops=1)
             Group Key: (date_trunc('minute'::text, cpu."time"))
             ->  Custom Scan (ChunkAppend) on cpu  (cost=0.44..827155.96 rows=17120526 width=16) (actual time=32.262..1270.585 rows=12
    0001 loops=1)
                   Order: date_trunc('minute'::text, cpu."time") DESC
                   ->  Index Scan using _hyper_1_1_chunk_cpu_time_idx on _hyper_1_1_chunk  (cost=0.44..784354.64 rows=17120526 width=1
    6) (actual time=32.257..1230.772 rows=120001 loops=1)
                         Index Cond: ("time" < '2021-01-01 19:00:00+08'::timestamp with time zone)
     Planning Time: 261.787 ms
     Execution Time: 1300.790 ms 

![](https://upload-images.jianshu.io/upload_images/20224274-d40c1127d16bc93d.png)

å›¾ 7 åˆ†ç»„æŸ¥è¯¢å limit è·å–

æ•°æ®åº“æ•°æ®é‡è¶Šå¤§ï¼Œè¿™ä¸ªæ—¶é—´å·®ä¼šæ‹‰å¼€å¾—è¶Šå¤§

**åˆ é™¤æ•°æ®åº“æ•°æ®**

æ—¶é—´åºåˆ—æ•°æ®é€šå¸¸å»ºç«‹å¾—éå¸¸å¿«ï¼Œå› æ­¤éœ€è¦æ•°æ®ä¿ç•™ç­–ç•¥ï¼Œä¾‹å¦‚ â€œä»…å°†åŸå§‹æ•°æ®å­˜å‚¨ä¸€å‘¨â€ã€‚TimescaleDB æä¾›äº†æ•°æ®ç®¡ç†å·¥å…·ï¼Œä½¿å®æ–½æ•°æ®ä¿ç•™ç­–ç•¥å˜å¾—å®¹æ˜“ï¼Œè€Œä¸”æ€§èƒ½æ˜æ˜¾é«˜äº PostgreSQLã€‚

äº‹å®ä¸Šï¼Œå°†æ•°æ®ä¿ç•™ç­–ç•¥ä¸èšåˆçš„ä½¿ç”¨ç›¸ç»“åˆæ˜¯å¾ˆå¸¸è§çš„ï¼Œå› æ­¤æœ‰æ—¶å¯èƒ½ä¿ç•™ä¸¤ä¸ªè¶…çº§è¡¨ï¼šä¸€ä¸ªåŒ…å«åŸå§‹æ•°æ®ï¼Œå¦ä¸€ä¸ªåŒ…å«æ•°æ®æ±‡æ€»åˆ°æ¯åˆ†é’Ÿæˆ–æ¯å°æ—¶çš„èšåˆè¡¨ä¸­ã€‚ç„¶åï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªè¶…çº§è¡¨ä¸Šå®šä¹‰ä¸åŒçš„ä¿ç•™ç­–ç•¥ï¼Œä¾‹å¦‚ï¼Œå°†èšåˆæ•°æ®å­˜å‚¨æ›´é•¿æ—¶é—´ï¼Œè€Œåªä¿ç•™åŸå§‹æ•°æ®ä¸€ä¸ªæœˆã€‚

TimescaleDB é€šè¿‡ drop_chunks() åŠŸèƒ½åœ¨å—çº§åˆ«è€Œä¸æ˜¯è¡Œçº§åˆ«æœ‰æ•ˆåˆ é™¤æ—§æ•°æ®ã€‚æ¯”å¦‚ä¹‹å‰æˆ‘ä»¬è¿™ 1 äº¿æ•°æ®ï¼Œåœ¨è¶…è¡¨ä¸­ä»¥ 12h ä¸€ä¸ªå—å­˜å‚¨ï¼Œä¼šæœ‰ 6 ä¸ªå—ã€‚ä¸‹é¢å°†æ¯”è¾ƒåˆ é™¤ä¸€å¤©æ•°æ®ï¼ˆå› ä¸ºå‰é¢æ•°æ®æ˜¯ä»¥ UTC ä¸ºå‡†ï¼Œæ‰€ä»¥è¶…è¡¨å‘åæ¨ 8 å°æ—¶ï¼‰  
-- æ™®é€šè¡¨

    normal=# explain analyze delete from cpu where time < '2021-01-02 00:00:00';
                                                                        QUERY PLAN                                                    
                    
    ----------------------------------------------------------------------------------------------------------------------------------
    ----------------
     Delete on cpu  (cost=0.57..1146936.37 rows=25035703 width=6) (actual time=388605.156..388605.157 rows=0 loops=1)
       ->  Index Scan using cpu_time_idx on cpu  (cost=0.57..1146936.37 rows=25035703 width=6) (actual time=65.239..343970.066 rows=23
    040000 loops=1)
             Index Cond: ("time" < '2021-01-02 00:00:00+08'::timestamp with time zone)
     Planning Time: 82.617 ms
     Execution Time: 388693.189 ms 

\-- è¶…è¡¨

    hypertable=# explain analyse select drop_chunks('cpu','2021-01-02 00:00:00');
                                                QUERY PLAN                                            
    --------------------------------------------------------------------------------------------------
     ProjectSet  (cost=0.00..5.02 rows=1000 width=32) (actual time=1107.801..1107.812 rows=1 loops=1)
       ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.007..0.007 rows=1 loops=1)
     Planning Time: 0.168 ms
     Execution Time: 1119.857 ms 

![](https://upload-images.jianshu.io/upload_images/20224274-288b386956c6ebaa.png)

å›¾ 8 æ¸…ç†æ•°æ®

TimescaleDB çš„ drop_chunks ä»è¶…è¡¨ä¸­åˆ é™¤æ‰€æœ‰åªåŒ…å«æ—©äºæŒ‡å®šæŒç»­æ—¶é—´çš„æ•°æ®çš„å—ã€‚å› ä¸ºå—æ˜¯å•ç‹¬çš„è¡¨ï¼Œåˆ é™¤çš„ç»“æœæ˜¯ç®€å•åœ°ä»æ–‡ä»¶ç³»ç»Ÿä¸­åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œå› æ­¤éå¸¸å¿«ï¼Œåœ¨ 10 æ¯«ç§’å†…å®Œæˆã€‚åŒæ—¶ï¼ŒPostgreSQL éœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½å®Œæˆï¼Œå› ä¸ºå®ƒå¿…é¡»åˆ é™¤è¡¨ä¸­çš„å•æ•°æ®è¡Œã€‚

TimescaleDB çš„æ–¹æ³•è¿˜é¿å…äº†åº•å±‚æ•°æ®åº“æ–‡ä»¶ä¸­çš„ç¢ç‰‡ï¼Œä»è€Œé¿å…äº†åœ¨éå¸¸å¤§çš„è¡¨ä¸­å¯èƒ½é¢å¤–æ˜‚è´µï¼ˆå³è€—æ—¶ï¼‰çš„æ¸…ç†éœ€è¦ã€‚

## äº”ã€ç”¨äºæ—¶é—´åºåˆ—æ“ä½œçš„æ–°åŠŸèƒ½

åœ¨å•ç£ç›˜æœºå™¨ä¸Šï¼Œè®¸å¤šåªæ‰§è¡Œç´¢å¼•æŸ¥æ‰¾æˆ–è¡¨æ‰«æçš„ç®€å•æŸ¥è¯¢åœ¨ PostgreSQL å’Œ TimescaleDB ä¹‹é—´çš„æ€§èƒ½ç›¸ä¼¼ã€‚ä¾‹å¦‚ä¸Šè¿°æ€§èƒ½æµ‹è¯•çš„ç®€å•æŸ¥è¯¢ã€‚

TimescaleDB é™¤äº†æ”¯æŒå®Œæ•´çš„ SQL å¤–ï¼Œè¿˜æœ‰è®¸å¤šå®šåˆ¶çš„ SQL å‡½æ•°ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»¥æ›´å°‘çš„ä»£ç è¡Œæ‰§è¡Œæ—¶é—´åºåˆ—åˆ†æã€‚

1ã€time_bucket() - ç”¨äºåˆ†æä»»æ„æ—¶é—´é—´éš”çš„æ•°æ®

å¯ä»¥å°† time_bucket çœ‹ä½œ PostgreSQL date_trunc å‡½æ•°çš„å¢å¼ºç‰ˆã€‚time_bucket å…è®¸ä»»æ„æ—¶é—´é—´éš”ï¼ˆä¾‹å¦‚ 10 ç§’ã€15 åˆ†é’Ÿã€6 å°æ—¶ï¼‰ï¼Œè€Œ date_trunc ä»…æä¾›æ ‡å‡†æ—¥ã€åˆ†ã€å°æ—¶ã€‚

ç¤ºä¾‹ï¼šæ¯ä¸ª host åœ¨ 1 å°æ—¶å†…æ¯ 5 åˆ†é’Ÿçš„æŸä¸ª cpu æŒ‡æ ‡å¹³å‡å€¼  
è¿™æ˜¯ postgres ä¸­ç”¨äºæ—¶é—´æ®µçš„è§£å†³æ–¹æ³•ä¹‹ä¸€ [Stack Overflow](https://links.jianshu.com/go?to=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F12045600%2Fpostgresql-sql-group-by-time-interval-with-arbitrary-accuracy-down-to-milli-sec)

    SELECT
        c.hostname, i.start_time, AVG ( C.usage_user ) 
    FROM cpu AS C 
    RIGHT JOIN (
        SELECT
            ( SELECT MIN ( TIME ) :: DATE FROM cpu ) + ( n || ' minutes' ) :: INTERVAL start_time,
            ( SELECT MIN ( TIME ) :: DATE FROM cpu ) + ( ( n + 5 ) || ' minutes' ) :: INTERVAL end_time 
        FROM
            generate_series ( 0, ( 24 * 60 ), 5 ) n 
    ) AS i ON C.TIME >= i.start_time AND C.TIME < i.end_time 
    WHERE
        C.TIME >= '2021-01-02 12:00:00' AND C.TIME < '2021-01-02 13:00:00' 
    GROUP BY
        i.start_time, C.hostname 
    ORDER BY
        c.hostname asc, i.start_time ASC; 

ä¸‹é¢æ˜¯ timescaleDB è§£å†³æ–¹æ³•ï¼š

    SELECT
        hostname,
        time_bucket ( '5 minute', TIME ) AS fifteen,
        AVG ( usage_user ) AS avg_usage_user 
    FROM
        cpu 
    WHERE
        TIME >= '2021-01-02 12:00:00' 
        AND TIME < '2021-01-02 13:00:00' 
    GROUP BY
        fifteen,
        hostname 
    ORDER BY
        hostname ASC, fifteen ASC 

ä¸ä»…æ›´ç®€æ´ï¼Œè€Œä¸”æŸ¥è¯¢é€Ÿåº¦ä¹Ÿå·®äº†å‡ åå€ã€‚

2ã€last()ï¼Œfirst() - ç”¨äºåˆ†æèšåˆä¸­çš„æ•°æ®

last() å’Œ first() ä¸€èˆ¬ç”¨äºèšåˆå‡½æ•°ä¸­ï¼Œå¯ç”¨äºæŸ¥è¯¢ç»„ä¸­çš„æœ€åä¸€æ¡ / æœ€åä¸€æ¡ã€‚

ç¤ºä¾‹ï¼š1 å°æ—¶å†…ï¼Œæ¯ä¸ª host æ¯åˆ†é’Ÿæœ€åä¸€æ¡æ•°æ®ã€‚  
postgres

    SELECT
        hostname, time, dt, usage_user 
    FROM
        (
        SELECT ROW_NUMBER ( ) OVER ( PARTITION BY dt, hostname ORDER BY TIME DESC ) row_id,
            dt, hostname, time, usage_user 
        FROM
            ( SELECT hostname, time, usage_user, date_trunc( 'minute', TIME ) dt FROM cpu WHERE time> '2021-01-03 00:00:00' AND time< '2021-01-03 01:00:00' ) AS t 
        ) AS rs
    WHERE
        rs.row_id = 1 
    ORDER BY
        hostname,
    TIME 

timescaleDB

    SELECT
        time_bucket ( '1 minute', time) one_min, hostname, LAST ( usage_user, time) 
    FROM cpu 
    WHERE
        time>= '2021-01-03 00:00:00' AND time< '2021-01-03 01:00:00'
    GROUP BY
        one_min, hostname 
    ORDER BY
        hostname, one_min 

3ã€time_bucket_gapfill() - å¡«å……é—´éš™

æœ‰æ—¶æˆ‘ä»¬çš„æ•°æ®ä¸­é—´ä¸¢å¤±äº†ä¸€æ®µï¼Œä¼šå¯¼è‡´æ•°æ®ä¸è¿ç»­ï¼Œå¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€æ±‚ï¼Œå°±å¿…é¡»é€šè¿‡ä¸€äº›æ‰‹æ®µç”Ÿæˆç¼ºå¤±æ•°æ®ã€‚  
ä¾‹å¦‚ï¼šè·å–ä¸Šå‘¨æ¯ä¸ªè®¾å¤‡æ¯å¤©çš„æ¸©åº¦ï¼Œæ’å…¥ç¼ºå¤±çš„è¯»æ•°ï¼š

    SELECT
      time_bucket_gapfill('1 day', time, now() - INTERVAL '1 week', now()) AS day,
      device_id,
      avg(temperature) AS value,
      interpolate(avg(temperature))
    FROM metrics
    WHERE time > now () - INTERVAL '1 week'
    GROUP BY day, device_id
    ORDER BY day;

               day          | device_id | value | interpolate
    ------------------------+-----------+-------+-------------
     2019-01-10 01:00:00+01 |         1 |       |
     2019-01-11 01:00:00+01 |         1 |   5.0 |         5.0
     2019-01-12 01:00:00+01 |         1 |       |         6.0
     2019-01-13 01:00:00+01 |         1 |   7.0 |         7.0
     2019-01-14 01:00:00+01 |         1 |       |         7.5
     2019-01-15 01:00:00+01 |         1 |   8.0 |         8.0
     2019-01-16 01:00:00+01 |         1 |   9.0 |         9.0
    (7 row) 

ä¸€èˆ¬æ¥è¯´ï¼Œå•ç‹¬ä½¿ç”¨ time_bucket_gapfill() åªä¼šå¡«å……ç¼ºå¤±æ—¶é—´ç‚¹ï¼Œä½†æ˜¯ä¸ä¼šå¡«å……æ•°æ®ï¼Œè¦é…åˆ locf() å’Œ interpolate() æ¥ä½¿ç”¨ã€‚

-   locf()ï¼šå¯è®©å°†ç©ºå€¼å¡«å……æˆèšåˆåˆ†ç»„ä¸­å‰ä¸€ä¸ªåˆ†ç»„çš„å€¼ã€‚
-   interpolate()ï¼šå¯¹ç¼ºå¤±å€¼è¿›è¡Œçº¿æ€§æ’å€¼ã€‚

timescaleDB è¿˜æä¾›äº†å¾ˆå¤šèšåˆã€ç»Ÿè®¡ã€è®¡ç®—ç­‰ APIï¼Œå¯å‰å¾€å®˜ç½‘æŸ¥é˜…ï¼Œæ­¤å¤„ä¸ä¸€ä¸€èµ˜è¿°ã€‚[TimescaleDB API å‚è€ƒ](https://links.jianshu.com/go?to=https%3A%2F%2Fdocs.timescale.com%2Fapi%2Flatest%2F%23apis-grouped-by-related-feature)

æ›´å¤šç²¾å½©å†…å®¹ï¼Œå°±åœ¨ç®€ä¹¦ APP

"å°ç¤¼ç‰©èµ°ä¸€èµ°ï¼Œæ¥ç®€ä¹¦å…³æ³¨æˆ‘"

è¿˜æ²¡æœ‰äººèµèµï¼Œæ”¯æŒä¸€ä¸‹

[![](https://cdn2.jianshu.io/assets/default_avatar/2-9636b13945b9ccf345bc98d0d81074eb.jpg)
](https://www.jianshu.com/u/136525c3d5b5)

### è¢«ä»¥ä¸‹ä¸“é¢˜æ”¶å…¥ï¼Œå‘ç°æ›´å¤šç›¸ä¼¼å†…å®¹

### æ¨èé˜…è¯»[æ›´å¤šç²¾å½©å†…å®¹](https://www.jianshu.com/)

-   ä¸€ã€æµ‹è¯•ç¯å¢ƒ æ“ä½œç³»ç»Ÿï¼šCentOS 7.8ï¼ˆè™šæ‹Ÿæœºï¼‰Postgresql ç‰ˆæœ¬ï¼š10.11.3CPUï¼šIntel(...

    [![](https://upload-images.jianshu.io/upload_images/20224274-1d4aa56a189d6f5b.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/c646f26feb04)
-   PostgreSQL , TimescaleDB , æ—¶é—´åºåˆ— , ç‰©è”ç½‘ , IoT èƒŒæ™¯ éšç€ç‰©è”ç½‘çš„å‘å±•ï¼Œæ—¶...


-   æœ€è¿‘çœ‹åˆ°è¿™ä¸ªå¼€æºæ—¶åºæ•°æ®åº“, åŸºäº postgrSQL,github å·²ç» 2600 å¤šé¢—æ˜Ÿ, é€‚åˆä¼ æ„Ÿå™¨é‡‡é›†ï¿½æ•°æ®çš„å­˜å‚¨ä»¥åŠ...

    [![](https://upload.jianshu.io/users/upload_avatars/1650675/64e266f08b82.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/48/h/48/format/webp)
    å“\_ç„¶](https://www.jianshu.com/u/0a3d1330fd66)é˜…è¯» 7,645 è¯„è®º 0 èµ 4

    [![](https://upload-images.jianshu.io/upload_images/1650675-503691e8b6bd0fb2.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/3e2e5847f70a)
-   è½¬è½½è‡ªï¼š[https://www.cnblogs.com/Detector/p/10104254.html](https://www.cnblogs.com/Detector/p/10104254.html) http...

    [![](https://upload-images.jianshu.io/upload_images/19660942-2ff32291e4e7790d.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/cb807170d648)
-   ä½œè€…ï¼šMichealï¼Œè…¾è®¯èµ„æ·±åå°å¼€å‘å·¥ç¨‹å¸ˆã€‚ WeTest å¯¼è¯»æœåŠ¡å™¨æ€§èƒ½æµ‹è¯•æ˜¯ä¸€é¡¹éå¸¸é‡è¦è€Œä¸”å¿…è¦çš„å·¥ä½œï¼Œæœ¬æ–‡æ˜¯...

    [![](https://cdn2.jianshu.io/assets/default_avatar/8-a356878e44b45ab268a3b0bbaaadeeb7.jpg)
    é¥­ç›’](https://www.jianshu.com/u/9b6a6b2cd6e6)é˜…è¯» 816 è¯„è®º 1 èµ 11

    [![](https://upload-images.jianshu.io/upload_images/1944350-cf661d98482226c2.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/5fd97d9eee51)
-   1\. æœåŠ¡å™¨æ€§èƒ½æµ‹è¯•å°ç»“ è®²åˆ°æœåŠ¡å™¨æ€§èƒ½å¤§éƒ¨åˆ†äººä¼šæƒ³åˆ°è¿™ä¸ªæœåŠ¡å™¨çš„æ¶æ„æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œç”¨çš„ä»€ä¹ˆ epollï¼Œselect...


-   å¼•è¨€ è°ˆåˆ°æ€§èƒ½æµ‹è¯•ï¼Œéƒ¨åˆ†å…¬å¸è¿ä¸“é—¨ç”¨äºæ€§èƒ½æµ‹è¯•çš„ç¯å¢ƒéƒ½æ²¡æœ‰ï¼Œæ›´åˆ«ææ€§èƒ½æµ‹è¯•æ¡†æ¶ / å¹³å°äº†ã€‚ä¸‹é¢ï¼Œç¬”è€…å°± â€œåŸºäº Jmet...

    [![](https://upload-images.jianshu.io/upload_images/5997551-30048e5f8cb6a803.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/3d2d0ee350d4)
-   å‰è¨€ InfluxDB æ˜¯ä¸€ä¸ªå¹´è½»çš„æ—¶åºæ•°æ®åº“ï¼Œæ˜¯ç”¨åŒæ ·å¾ˆå¹´è½»çš„è¯­è¨€ GO å¼€å‘å‡ºæ¥çš„ã€‚å°æ•°æ®é‡çš„æ—¶å€™è¿˜æ€§èƒ½è¿˜ä¸é”™ï¼Œä½†æ˜¯...

    [![](https://upload-images.jianshu.io/upload_images/22668799-69270ec1cf3a5bbb.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/f91a98bbb7b3)
-   å½“å‰æœ‰ä¸€ä¸ªæœåŠ¡çš„æ—¥å¿—è¡¨ï¼Œéœ€è¦æ¯æ—¥è¿›è¡Œæ¸…ç†ã€‚å½“å‰çš„åšæ³•æ˜¯ truncateï¼Œä½†æ˜¯ä¼šå¯¼è‡´ä¸šåŠ¡ 1 åˆ†é’Ÿå·¦å³ä¸èƒ½æ­£å¸¸æä¾›æœåŠ¡ã€‚...
-   æœ¬æ–‡æˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ JMeter+InfluxDB+Grafana æ‰“é€ å‹æµ‹å¯è§†åŒ–å®æ—¶ç›‘æ§ã€‚ InfluxDB æ˜¯ä¸€...


-   æ€§èƒ½æŒ‡æ ‡åˆ†ç±» åœ¨è¿›è¡Œæ€§èƒ½æµ‹è¯•çš„æŒ‡æ ‡ç›‘æ§å’Œç»“æœåˆ†ææ—¶ï¼Œå¯ä»¥å…³æ³¨ä»¥ä¸‹è¿™å‡ ä¸ªç»´åº¦çš„æŒ‡æ ‡ï¼š ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ èµ„æºæ€§èƒ½æŒ‡æ ‡ æ•°...

    [![](https://upload.jianshu.io/users/upload_avatars/13826085/c52262b7-8387-497e-88f6-02e52cd3e5f9?imageMogr2/auto-orient/strip|imageView2/1/w/48/h/48/format/webp)
    çŒªå„¿æ‰“æ»š](https://www.jianshu.com/u/2b4190d632dd)é˜…è¯» 1,284 è¯„è®º 0 èµ 6

    [![](https://upload-images.jianshu.io/upload_images/13826085-dc84673c6968453e.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/791ffdacdc97)

-   ç‰ˆæƒå£°æ˜: æœ¬æ–‡ç”±ç¥å·æ•°ç äº‘åŸºåœ°å›¢é˜Ÿæ•´ç†æ’°å†™ï¼Œè‹¥è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ ä¸€ã€å‰è¨€ TiDB ä½œä¸º New SQL æ•°æ®åº“çš„...

    [![](https://upload-images.jianshu.io/upload_images/25446753-fe02059bb630004f.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/56f4cb7ffc8b)

-   ä»Šå¤©ç»™å¤§å®¶ä»‹ç»çš„å°±æ˜¯é˜¿ è´äº‘ä¸»æœºï¼Œé˜¿ è´äº‘æ˜¯æä¾›å… è´¹è™šæ‹Ÿä¸»æœºå… è´¹äº‘æœåŠ¡å™¨çš„ï¼Œå¸Œæœ›å¤§å®¶ä¸è¦é”™è¿‡äº†ã€‚ è®²åˆ°æœåŠ¡å™¨æ€§...

    [![](https://upload-images.jianshu.io/upload_images/2231755-13af85545b5161ad?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/54cb64a73d3f)

-   æ€§èƒ½æµ‹è¯•ç®€ä»‹ æ¦‚å¿µ: é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·æ¨¡æ‹Ÿå¤šç§æ­£å¸¸ã€å³°å€¼ä»¥åŠå¼‚å¸¸è´Ÿè½½æ¡ä»¶æ¥å¯¹ç³»ç»Ÿçš„å„é¡¹æ€§èƒ½æŒ‡æ ‡è¿›è¡Œæµ‹è¯•ã€‚ Why è¯„...

    [![](https://upload-images.jianshu.io/upload_images/10819934-f69c6ebce69e50a2.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/10896d189376)

-   !\[Flask](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAW...

-   åŒèƒå¦Šå¨ æœ‰å®¶æ—é—ä¼ å€¾å‘ï¼Œéšæ¯ç³»é—ä¼ ã€‚æœ‰ç ”ç©¶è¡¨æ˜ï¼Œå¦‚æœå­•å¦‡æœ¬äººæ˜¯åŒèƒä¹‹ä¸€ï¼Œå¥¹ç”ŸåŒèƒçš„æœºç‡ä¸º 1/58ï¼›è‹¥å­•å¦‡çš„çˆ¶äº²æˆ–æ¯...

-   ä»Šå¤©ç†å¥½äº†è¡Œæï¼Œçœ‹åˆ°å¿«è¦ä¹ç‚¹äº†ï¼Œå°±å¾ˆåŒ†å¿™çš„æ´—å¤´æ´—æ¾¡ï¼Œï¼ˆå¿ƒå­˜ä¸€ä»½å¿µæƒ³ï¼Œä½ æ€»ä¼šæ‰“ç»™æˆ‘çš„ğŸ¶ï¼‰ç„¶åæŠŠæ´—å¤´æ¶²å½“æˆæ²æµ´æ¶²äº†ğŸ˜¨ï¼Œ...

-   é‚£å¹´æˆ‘ä»¬ 15ï¼Œåƒé˜³å…‰ä¸€æ ·æ¸©æš–çš„å¹´çºªã€‚æ¯å¤©æˆ‘éƒ½ä¼šéª‘è‡ªè¡Œè½¦ä¸Šå­¦ï¼Œè·¯è¿‡ç”°é‡ï¼Œå·¥å‚ï¼ŒåŒ»é™¢ï¼Œæ‘åº„ï¼Œæœ‰å¾®é£ï¼Œæœ‰é˜³å…‰ï¼Œæœ‰ç»¿...


-   æœ€è¿‘èº«è¾¹æœ‰ä¸¤å¯¹å°ä¸¤å£åœ¨å†·æˆ˜ï¼Œæ„Ÿè§‰æˆ˜äº‹éšæ—¶èƒ½å‡çº§åˆ°è¦åˆ†å¼€çš„åœ°æ­¥ã€‚ä¸å¹¸çš„äººå„æœ‰å„çš„ä¸å¹¸ï¼Œç„¶è€Œåœ¨åˆšåˆšåœ¨ä¸€èµ·çš„æ—¶å€™ä»–ä»¬å¹¶ä¸...

    [![](https://cdn2.jianshu.io/assets/default_avatar/9-cceda3cf5072bcdd77e8ca4f21c40998.jpg)
    è‹è§…è§…](https://www.jianshu.com/u/6cf62758fa37)é˜…è¯» 468 è¯„è®º 0 èµ 1

    [![](https://upload-images.jianshu.io/upload_images/884232-47152b5779268c17.jpeg?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
    ](https://www.jianshu.com/p/90395c96f270)
-   å—Ÿä¹ï¼ä½™å°†å¼±å† ä¹ŸçŸ£ï¼ æ—¶åºè½®æ›¿ï¼Œç™½é©¹è¿‡éš™ã€‚å…‰é˜´èè‹’ï¼Œå²é€¢å¹´å…³ã€‚å¼ƒå‹ºèˆè€Œå°±è±¡ï¼Œä¹…å¿—å­¦è€Œå°†å† ã€‚ ä¸œéš…å·²é€ï¼Œæ¡‘æ¦†æè¿Ÿã€‚èµ„...
       [![](https://upload-images.jianshu.io/upload_images/794326-7ed02761507f9d09.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240/format/webp)
       ](https://www.jianshu.com/p/3d742eead224) 
    [https://www.jianshu.com/p/125ff16d79f9](https://www.jianshu.com/p/125ff16d79f9)
